{% extends "base.html" %}
{% block content %}
<div class="page-header">
    <h1>RelatÃ³rios</h1>
    <p>Resumo e anÃ¡lise das suas despesas</p>
</div>

<!-- ðŸ”¹ RESUMO DE DADOS -->
<div class="summary-section">
    <div class="summary-card">
        <h3>Total Gasto</h3>
        <p class="valor">R$ {{ total_gasto | round(2) }}</p>
    </div>
    <div class="summary-card">
        <h3>MÃ©dia por Categoria</h3>
        <p class="valor">R$ {{ media_por_categoria | round(2) }}</p>
    </div>
    <div class="summary-card destaque">
        <h3>Maior Despesa</h3>
        <p class="valor">{{ categoria_maior_gasto }}</p>
    </div>
    <div class="summary-card">
        <h3>PerÃ­odo</h3>
        <p class="valor">{{ periodo }}</p>
    </div>
</div>

<!-- ðŸ”¹ GRÃFICOS -->
<div class="charts-section">
    <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; position: relative;">
        <div class="section-title">
            <h2>GrÃ¡ficos e VisualizaÃ§Ãµes</h2>
            <p>RepresentaÃ§Ã£o visual dos seus dados financeiros</p>
        </div>

        <!-- BotÃ£o PDF (agora chamando o BACKEND) -->
        <a href="{{ url_for('exportar_pdf') }}"
           title="Exportar RelatÃ³rio em PDF"
           style="background: none; border: none; cursor: pointer; padding: 6px 10px; position: absolute; right: 0; top: 5px;">
            <svg xmlns="http://www.w3.org/2000/svg" fill="#10b981" viewBox="0 0 24 24" width="24" height="24">
                <path d="M5 20h14v-2H5v2zm7-18-5.5 5.5h4v6h3v-6h4L12 2z"/>
            </svg>
        </a>
    </div>

    <div class="charts-grid">
        <!-- GrÃ¡fico por Categoria -->
        <div class="chart-card">
            <div class="chart-header">
                <h3>Gastos por Categoria</h3>
            </div>
            <div class="chart-container">
                <canvas id="categoriaChart"></canvas>
            </div>
        </div>

        <!-- GrÃ¡fico por MÃªs -->
        <div class="chart-card">
            <div class="chart-header">
                <h3>Gastos por MÃªs</h3>
            </div>
            <div class="chart-container">
                <canvas id="mesChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // ðŸ”¸ GrÃ¡fico de Gastos por Categoria
    const ctxCat = document.getElementById('categoriaChart').getContext('2d');
    const categoriaChart = new Chart(ctxCat, {
        type: 'doughnut',
        data: {
            labels: {{ categorias_labels|tojson }},
            datasets: [{
                data: {{ categorias_valores|tojson }},
                backgroundColor: ['#10b981','#3b82f6','#8b5cf6','#f97316','#ef4444','#22c55e','#0ea5e9','#9333ea'],
                borderWidth: 1
            }]
        },
        options: { plugins: { legend: { position: 'bottom' } } }
    });

    // ðŸ”¸ GrÃ¡fico de Gastos por MÃªs
    const ctxMes = document.getElementById('mesChart').getContext('2d');
    const mesChart = new Chart(ctxMes, {
        type: 'bar',
        data: {
            labels: {{ meses_labels|tojson }},
            datasets: [{
                label: 'Total por mÃªs (R$)',
                data: {{ meses_valores|tojson }},
                backgroundColor: '#10b981',
                borderRadius: 6,
                borderSkipped: false
            }]
        },
        options: {
            scales: {
                y: { beginAtZero: true, title: { display: true, text: 'Valor em Reais (R$)' } },
                x: { title: { display: true, text: 'MÃªs de referÃªncia' } }
            },
            plugins: { legend: { display: false } }
        }
    });
</script>

<style>
.summary-section {
    display: flex;
    justify-content: space-between;
    flex-wrap: wrap;
    margin-bottom: 25px;
    gap: 15px;
}

.summary-card {
    flex: 1 1 220px;
    background: #f9fafb;
    border-radius: 12px;
    padding: 12px 16px;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

.summary-card h3 {
    color: #6b7280;
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 4px;
}

.summary-card .valor {
    font-size: 1.2rem;
    font-weight: 600;
    color: #10b981;
    margin-top: 2px;
}

.summary-card.destaque {
    background: #ecfdf5;
    border: 1px solid #10b981;
}
</style>

{% endblock %}
