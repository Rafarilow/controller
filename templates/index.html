{% extends "base.html" %}
{% block content %}
<div class="page-header">
    <h1>Minhas Despesas</h1>
    <p>Acompanhe e gerencie seus gastos</p>
</div>

<div class="summary-section">
    <div class="summary-card total-card">
        <div class="summary-icon">
            💰
        </div>
        <div class="summary-content">
            <h3>Total Geral</h3>
            <p class="summary-value">R$ {{ "%.2f"|format(total_geral) }}</p>
            <div class="summary-trend">
                <span>Total acumulado</span>
            </div>
        </div>
    </div>
</div>

<div class="form-section">
    <div class="section-header">
        <div class="section-title">
            <h2>Adicionar Despesa</h2>
            <p>Preencha os campos abaixo para cadastrar uma nova despesa</p>
        </div>
    </div>
    <form action="{{ url_for('adicionar') }}" method="POST" class="expense-form">
        <div class="form-row">
            <div class="form-group">
                <label>Data</label>
                <input type="date" name="data" required>
            </div>
            <div class="form-group">
                <label>Descrição</label>
                <input type="text" name="descricao" required>
            </div>
            <div class="form-group">
                <label>Categoria</label>
                <select name="categoria" required>
                    <option value="Alimentação">🍽️ Alimentação</option>
                    <option value="Transporte">🚗 Transporte</option>
                    <option value="Saúde">🏥 Saúde</option>
                    <option value="Educação">📚 Educação</option>
                    <option value="Lazer">🎮 Lazer</option>
                    <option value="Casa">🏠 Casa</option>
                    <option value="Roupas">👕 Roupas</option>
                    <option value="Outros">📦 Outros</option>
                </select>
            </div>
            <div class="form-group">
                <label>Valor</label>
                <input type="number" step="0.01" name="valor" required>
            </div>
        </div>
        <button type="submit" class="btn-primary">Adicionar</button>
    </form>
</div>


<div class="table-section">
    <div class="section-header">
        <div class="section-title">
            <h2>Histórico de Despesas</h2>
            <p>Todas as despesas registradas</p>
        </div>
        <span class="expense-count">{{ despesas|length }} registros</span>
    </div>

    <div class="table-container">
        <table class="expense-table">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Descrição</th>
                    <th>Categoria</th>
                    <th>Valor (R$)</th>
                    <th class="text-right">Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for d in despesas %}
                <tr>
                    <td class="date-cell">{{ d["data"] }}</td>
                    <td class="description-cell">{{ d["descricao"] }}</td>
                    <td><span class="category-badge">{{ d["categoria"] }}</span></td>
                    <td class="value-cell">R$ {{ "%.2f"|format(d["valor"] or 0) }}</td>
                    <td class="text-right">
                        <div class="actions-menu">
                            <button class="menu-toggle" onclick="toggleMenu('{{ d['id'] }}')">✏️</button>
                            <div id="menu-{{ d['id'] }}" class="menu-dropdown hidden">
                                <!-- Editar -->
                                <button type="button" class="action-btn btn-delete" onclick="toggleEdit('{{ d['id'] }}')">✏️</button>
                                <!-- Excluir -->
                                <form action="{{ url_for('deletar', id=d['id']) }}" method="POST">
                                    <button type="submit" class="action-btn btn-delete">🗑️</button>
                                </form>
                            </div>
                        </div>

                       
                        <div id="edit-form-{{ d['id'] }}" class="edit-form hidden">
                            <form action="{{ url_for('editar', id=d['id']) }}" method="POST" class="inline-form">
                                <input type="date" name="data" value="{{ d['data'] }}" required>
                                <input type="text" name="descricao" value="{{ d['descricao'] }}" required>
                                <select name="categoria" required>
                                    <option value="Alimentação" {% if d['categoria']=='Alimentação' %}selected{% endif %}>🍽️ Alimentação</option>
                                    <option value="Transporte" {% if d['categoria']=='Transporte' %}selected{% endif %}>🚗 Transporte</option>
                                    <option value="Saúde" {% if d['categoria']=='Saúde' %}selected{% endif %}>🏥 Saúde</option>
                                    <option value="Educação" {% if d['categoria']=='Educação' %}selected{% endif %}>📚 Educação</option>
                                    <option value="Lazer" {% if d['categoria']=='Lazer' %}selected{% endif %}>🎮 Lazer</option>
                                    <option value="Casa" {% if d['categoria']=='Casa' %}selected{% endif %}>🏠 Casa</option>
                                    <option value="Roupas" {% if d['categoria']=='Roupas' %}selected{% endif %}>👕 Roupas</option>
                                    <option value="Outros" {% if d['categoria']=='Outros' %}selected{% endif %}>📦 Outros</option>
                                </select>
                                <input type="number" step="0.01" name="valor" value="{{ d['valor'] or 0 }}" required>

                                <div class="edit-actions">
                                    <button type="submit" class="btn-primary">Salvar</button>
                                    <button type="button" class="btn-secondary" onclick="toggleEdit('{{ d['id'] }}')">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="text-center">Nenhuma despesa cadastrada</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function toggleMenu(id) {
    const menu = document.getElementById(`menu-${id}`);
    menu.classList.toggle("hidden");
}

function toggleEdit(id) {
    const form = document.getElementById(`edit-form-${id}`);
    form.classList.toggle("hidden");
}
</script>
{% endblock %}
