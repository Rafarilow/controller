{% extends "base.html" %}
{% block content %}
<div class="page-header">
    <h1>Minhas Despesas</h1>
    <p>Acompanhe e gerencie seus gastos</p>
</div>

<div class="summary-section">
    <div class="summary-card total-card">
        <div class="summary-icon">
            ğŸ’°
        </div>
        <div class="summary-content">
            <h3>Total Geral</h3>
            <p class="summary-value">R$ {{ "%.2f"|format(total_geral) }}</p>
            <div class="summary-trend">
                <span>Total acumulado</span>
            </div>
        </div>
    </div>
</div>

<div class="form-section">
    <div class="section-header">
        <div class="section-title">
            <h2>Adicionar Despesa</h2>
            <p>Preencha os campos abaixo para cadastrar uma nova despesa</p>
        </div>
    </div>
    <form action="{{ url_for('adicionar') }}" method="POST" class="expense-form">
        <div class="form-row">
            <div class="form-group">
                <label>Data</label>
                <input type="date" name="data" required>
            </div>
            <div class="form-group">
                <label>DescriÃ§Ã£o</label>
                <input type="text" name="descricao" required>
            </div>
            <div class="form-group">
                <label>Categoria</label>
                <select name="categoria" required>
                    <option value="AlimentaÃ§Ã£o">ğŸ½ï¸ AlimentaÃ§Ã£o</option>
                    <option value="Transporte">ğŸš— Transporte</option>
                    <option value="SaÃºde">ğŸ¥ SaÃºde</option>
                    <option value="EducaÃ§Ã£o">ğŸ“š EducaÃ§Ã£o</option>
                    <option value="Lazer">ğŸ® Lazer</option>
                    <option value="Casa">ğŸ  Casa</option>
                    <option value="Roupas">ğŸ‘• Roupas</option>
                    <option value="Outros">ğŸ“¦ Outros</option>
                </select>
            </div>
            <div class="form-group">
                <label>Valor</label>
                <input type="number" step="0.01" name="valor" required>
            </div>
        </div>
        <button type="submit" class="btn-primary">Adicionar</button>
    </form>
</div>


<div class="table-section">
    <div class="section-header">
        <div class="section-title">
            <h2>HistÃ³rico de Despesas</h2>
            <p>Todas as despesas registradas</p>
        </div>
        <span class="expense-count">{{ despesas|length }} registros</span>
    </div>

    <div class="table-container">
        <table class="expense-table">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>DescriÃ§Ã£o</th>
                    <th>Categoria</th>
                    <th>Valor (R$)</th>
                    <th class="text-right">AÃ§Ãµes</th>
                </tr>
            </thead>
            <tbody>
                {% for d in despesas %}
                <tr>
                    <td class="date-cell">{{ d["data"] }}</td>
                    <td class="description-cell">{{ d["descricao"] }}</td>
                    <td><span class="category-badge">{{ d["categoria"] }}</span></td>
                    <td class="value-cell">R$ {{ "%.2f"|format(d["valor"] or 0) }}</td>
                    <td class="text-right">
                        <div class="actions-menu">
                            <button class="menu-toggle" onclick="toggleMenu('{{ d['id'] }}')">âœï¸</button>
                            <div id="menu-{{ d['id'] }}" class="menu-dropdown hidden">
                                <!-- Editar -->
                                <button type="button" class="action-btn btn-delete" onclick="toggleEdit('{{ d['id'] }}')">âœï¸</button>
                                <!-- Excluir -->
                                <form action="{{ url_for('deletar', id=d['id']) }}" method="POST">
                                    <button type="submit" class="action-btn btn-delete">ğŸ—‘ï¸</button>
                                </form>
                            </div>
                        </div>

                       
                        <div id="edit-form-{{ d['id'] }}" class="edit-form hidden">
                            <form action="{{ url_for('editar', id=d['id']) }}" method="POST" class="inline-form">
                                <input type="date" name="data" value="{{ d['data'] }}" required>
                                <input type="text" name="descricao" value="{{ d['descricao'] }}" required>
                                <select name="categoria" required>
                                    <option value="AlimentaÃ§Ã£o" {% if d['categoria']=='AlimentaÃ§Ã£o' %}selected{% endif %}>ğŸ½ï¸ AlimentaÃ§Ã£o</option>
                                    <option value="Transporte" {% if d['categoria']=='Transporte' %}selected{% endif %}>ğŸš— Transporte</option>
                                    <option value="SaÃºde" {% if d['categoria']=='SaÃºde' %}selected{% endif %}>ğŸ¥ SaÃºde</option>
                                    <option value="EducaÃ§Ã£o" {% if d['categoria']=='EducaÃ§Ã£o' %}selected{% endif %}>ğŸ“š EducaÃ§Ã£o</option>
                                    <option value="Lazer" {% if d['categoria']=='Lazer' %}selected{% endif %}>ğŸ® Lazer</option>
                                    <option value="Casa" {% if d['categoria']=='Casa' %}selected{% endif %}>ğŸ  Casa</option>
                                    <option value="Roupas" {% if d['categoria']=='Roupas' %}selected{% endif %}>ğŸ‘• Roupas</option>
                                    <option value="Outros" {% if d['categoria']=='Outros' %}selected{% endif %}>ğŸ“¦ Outros</option>
                                </select>
                                <input type="number" step="0.01" name="valor" value="{{ d['valor'] or 0 }}" required>

                                <div class="edit-actions">
                                    <button type="submit" class="btn-primary">Salvar</button>
                                    <button type="button" class="btn-secondary" onclick="toggleEdit('{{ d['id'] }}')">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="text-center">Nenhuma despesa cadastrada</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function toggleMenu(id) {
    const menu = document.getElementById(`menu-${id}`);
    menu.classList.toggle("hidden");
}

function toggleEdit(id) {
    const form = document.getElementById(`edit-form-${id}`);
    form.classList.toggle("hidden");
}
</script>
<style>

    /* ğŸ”¹ Corrige layout da tabela */
.expense-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.95rem;
    table-layout: fixed; /* garante distribuiÃ§Ã£o uniforme */
}

/* ğŸ”¹ CabeÃ§alhos alinhados na horizontal */
.expense-table thead tr {
    display: table-row !important; /* forÃ§a linha horizontal */
}

.expense-table th {
    display: table-cell !important;
    background: #f9fafb;
    color: #374151;
    text-align: left;
    padding: 12px 14px;
    font-weight: 600;
    border-bottom: 1px solid #e5e7eb;
    white-space: nowrap;
}

/* ğŸ”¹ CÃ©lulas */
.expense-table td {
    display: table-cell;
    padding: 12px 14px;
    border-bottom: 1px solid #f3f4f6;
    color: #1f2937;
    vertical-align: middle;
}

/* ğŸ”¹ Ajuste das larguras */
.expense-table th:nth-child(1),
.expense-table td:nth-child(1) {
    width: 15%;
}
.expense-table th:nth-child(2),
.expense-table td:nth-child(2) {
    width: 30%;
}
.expense-table th:nth-child(3),
.expense-table td:nth-child(3) {
    width: 20%;
}
.expense-table th:nth-child(4),
.expense-table td:nth-child(4) {
    width: 20%;
}
.expense-table th:nth-child(5),
.expense-table td:nth-child(5) {
    width: 15%;
    text-align: right;
}

/* ğŸ”¹ Categoria (badge) */
.category-badge {
    background-color: #10b981;
    color: white;
    border-radius: 16px;
    padding: 4px 10px;
    font-size: 0.85rem;
}

/* ğŸ”¹ AÃ§Ãµes */
.actions {
    display: flex;
    justify-content: flex-end;
    gap: 6px;
}

</style>
{% endblock %}
