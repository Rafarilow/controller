{% extends "base.html" %}
{% block content %}
<div class="page-header">
    <h1>Controle suas despesas de forma inteligente</h1>
    <p></p>
</div>

<div class="stats-grid">
    <div class="stat-card primary">
        <div class="stat-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
        </div>
        <div class="stat-content">
            <h3>Total do M√™s</h3>
            <p class="stat-value">R$ {{ "%.2f"|format(total_geral or 0) }}</p>
        </div>
        <div class="stat-trend positive">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M7 17l6-6 6 6M13 11h6v6"/>
            </svg>
        </div>
    </div>
    
    <div class="stat-card secondary">
        <div class="stat-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14,2 14,8 20,8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
                <polyline points="10,9 9,9 8,9"/>
            </svg>
        </div>
        <div class="stat-content">
            <h3>Total de Despesas</h3>
            <p class="stat-value">{{ despesas|length }}</p>
        </div>
        <div class="stat-trend neutral">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M7 10l5 5 5-5"/>
            </svg>
        </div>
    </div>
    
    <div class="stat-card tertiary">
        <div class="stat-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 3v18h18"/>
                <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
            </svg>
        </div>
        <div class="stat-content">
            <h3>Categorias</h3>
            <p class="stat-value">{{ categorias|length }}</p>
        </div>
        <div class="stat-trend positive">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M7 17l6-6 6 6M13 11h6v6"/>
            </svg>
        </div>
    </div>
    
    <div class="stat-card quaternary">
        <div class="stat-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                <line x1="1" y1="10" x2="23" y2="10"/>
            </svg>
        </div>
        <div class="stat-content">
            <h3>√öltima Despesa</h3>
            <p class="stat-value">
                {% if despesas %}
                    R$ {{ "%.2f"|format(despesas[-1]['valor']) }}
                {% else %}
                    R$ 0,00
                {% endif %}
            </p>
        </div>
        <div class="stat-trend negative">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 7l-6 6-6-6"/>
            </svg>
        </div>
    </div>
</div>

<div class="form-section">
    <div class="section-header">
        <div class="section-title">
            <h2>Adicionar Nova Despesa</h2>
            <p>Registre uma nova despesa no sistema</p>
        </div>
    </div>
    
    <form action="{{ url_for('adicionar') }}" method="post" class="expense-form">
        <div class="form-row">
            <div class="form-group">
                <label for="data">Data</label>
                <input type="date" id="data" name="data" required>
            </div>
            
            <div class="form-group">
                <label for="categoria">Categoria</label>
                <select id="categoria" name="categoria" required>
                    <option value="">Selecione uma categoria</option>
                    {% for cat in categorias %}
                    <option value="{{ cat }}">{{ cat }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group full-width">
                <label for="descricao">Descri√ß√£o</label>
                <input type="text" id="descricao" name="descricao" placeholder="Ex: Compras no supermercado" required>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="valor">Valor (R$)</label>
                <input type="number" id="valor" name="valor" step="0.01" min="0" placeholder="0,00" required>
            </div>
            
            <div class="form-group">
                <button type="submit" class="btn-primary">Adicionar Despesa</button>
            </div>
        </div>
    </form>
</div>

<div class="table-section">
    <div class="section-header">
        <div class="section-title">
            <h2>Lista de Despesas</h2>
            <p>Hist√≥rico completo das suas despesas</p>
        </div>
        <div class="table-info">
            <span class="expense-count">{{ despesas|length }} despesa{{ 's' if despesas|length != 1 }}</span>
        </div>
    </div>
    
    {% if despesas %}
    <div class="table-container">
        <table class="expense-table">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Categoria</th>
                    <th>Descri√ß√£o</th>
                    <th>Valor</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody>
                {% for d in despesas %}
                <tr>
                    <td class="date-cell">{{ d['data'] }}</td>
                    <td><span class="category-badge">{{ d['categoria'] }}</span></td>
                    <td class="description-cell">{{ d['descricao'] }}</td>
                    <td class="value-cell">R$ {{ "%.2f"|format(d['valor']) }}</td>
                    <td>
                        <div class="action-buttons">
                            <!-- Bot√£o Editar -->
                            <button type="button" 
                                    class="action-btn btn-edit" 
                                    onclick="openEditModal({{ d['id'] }}, '{{ d['data'] }}', '{{ d['categoria'] }}', '{{ d['descricao'] }}', {{ d['valor'] }})">
                                ‚úèÔ∏è
                            </button>
                            <!-- Bot√£o Deletar -->
                            <form action="{{ url_for('deletar', id=d['id']) }}" method="post" style="display:inline;">
                                <button type="submit" class="action-btn btn-delete">üóëÔ∏è</button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">üìÑ</div>
        <h3>Nenhuma despesa cadastrada</h3>
        <p>Adicione sua primeira despesa usando o formul√°rio acima para come√ßar a controlar seus gastos.</p>
    </div>
    {% endif %}
</div>

<!-- Modal de edi√ß√£o -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <h2>Editar Despesa</h2>
    <form id="editForm" method="post">
      <div class="form-group">
        <label for="editData">Data</label>
        <input type="date" id="editData" name="data" required>
      </div>

      <div class="form-group">
        <label for="editCategoria">Categoria</label>
        <select id="editCategoria" name="categoria" required>
          {% for cat in categorias %}
            <option value="{{ cat }}">{{ cat }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group">
        <label for="editDescricao">Descri√ß√£o</label>
        <input type="text" id="editDescricao" name="descricao" required>
      </div>

      <div class="form-group">
        <label for="editValor">Valor (R$)</label>
        <input type="number" id="editValor" name="valor" step="0.01" min="0" required>
      </div>

      <div class="form-row">
        <button type="submit" class="btn-primary">Salvar Altera√ß√µes</button>
        <button type="button" class="btn-delete" onclick="closeEditModal()">Cancelar</button>
      </div>
    </form>
  </div>
</div>

<script>
function openEditModal(id, data, categoria, descricao, valor) {
    const modal = document.getElementById('editModal');
    modal.style.display = 'flex';

    document.getElementById('editData').value = data;
    document.getElementById('editCategoria').value = categoria;
    document.getElementById('editDescricao').value = descricao;
    document.getElementById('editValor').value = valor;

    document.getElementById('editForm').action = `/editar/${id}`;
}

function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
}

window.onclick = function(event) {
    const modal = document.getElementById('editModal');
    if (event.target === modal) {
        modal.style.display = "none";
    }
}
</script>
{% endblock %}
